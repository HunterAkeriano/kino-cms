import{l as B,m as o,q as p,s as m,u as i,x as b,y as u,z as v,B as f,C as g,D as w,E as y,G as E,I as d}from"./index-75be84c7.js";const x=B({id:"banners",state:()=>({movieBanners:{data:[],banners:[],deletedBanners:[],rotationSpeed:0},deletedBanners:[],url:"",text:"",name:"banner-"}),actions:{async getImages(){const a=o(i,"banners/top/");try{(await p(a)).items.forEach(async r=>{const e=await m(r),n=decodeURIComponent(e).split("/").pop().split("?")[0];this.movieBanners.banners.push({id:n,uploaded:!0,image:null,url:e}),this.movieBanners.data.push({url:e,name:n})})}catch(t){console.log(t)}},deleteMovieBanner(a){this.movieBanners.deletedBanners.push(this.movieBanners.data[a].name),this.deletedBanners.push(this.movieBanners.data[a].name),this.movieBanners.banners.splice(a,1),this.movieBanners.data.splice(a,1)},async uploadMovieBanners(){if(this.loading=!0,this.movieBanners.deletedBanners.length!==0){const e=[];for(let n=0;n<this.movieBanners.deletedBanners.length;n++){const s=o(i,"banners/top/"+this.movieBanners.deletedBanners[n]);e.push(b(s))}await Promise.all(e).then(()=>{console.log("Все выбранные файлы удалены успешно."),this.movieBanners.deletedBanners=[]}).catch(n=>{console.error("Ошибка удаления файлов:",n)})}const a=u(d,"banners"),t=await v(a),r=f(d);t.forEach(e=>{this.deletedBanners.includes(e.id)&&(console.log(e.ref),r.delete(e.ref))}),await r.commit();for(let e=0;e<this.movieBanners.banners.length;e++)if(this.movieBanners.banners[e].image!==null)try{const n=o(i,"banners/top/"+this.movieBanners.data[e].name);await g(n,this.movieBanners.banners[e].image).then(async()=>{await m(n).then(async s=>{this.movieBanners.data[e].image=s;const l=w(),h={name:this.movieBanners.data[e].name};await y(l,async c=>{c.set(E(l,"banners",this.movieBanners.data[e].name),h)})})}).catch(s=>{console.error("Error uploading banners: ",s)})}catch(n){console.error("Error uploading banners: ",n)}await new Promise(e=>setTimeout(e,100))}}});export{x as b};
