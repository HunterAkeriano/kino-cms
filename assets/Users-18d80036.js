import{a4 as B,a5 as $,a6 as S,a7 as _,a8 as y,a9 as w,aa as A,ab as I,ac as C,ad as m,ae as T,af as V,ag as F,x as h,J as G,e as b,r as j,o as c,g as p,u as v,n as z,m as k,h as e,y as H,H as J,F as U,k as W,G as q,t as g}from"./index-bfb3c343.js";const K=B({id:"Users",state:()=>({loading:!1,showModal:!1,usersList:[],uploaded:!1}),actions:{async getUsers(){this.loading=!0,this.usersList=[],(await $(S(m,"users"))).forEach(t=>{this.usersList.push({id:this.usersList.length,name:t.id,email:t.data().email,password:t.data().password,user:t.data().user,fullName:t.data().fullName,phone:t.data().phone,creditCard:t.data().creditCard,address:t.data().address,gender:t.data().gender,language:t.data().language,emailChange:t.data().email,birthday:t.data().birthday,passwordChange:"",passwordCheck:""})});for(let t=0;t<this.usersList.length;t++)typeof this.usersList[t].birthday=="object"&&(this.usersList[t].birthday=new Date(this.usersList[t].birthday.seconds*1e3));this.loading=!1},async deleteUser(s){this.loading=!0;const t=_(y);w(t,this.usersList[s].email,this.usersList[s].password).then(r=>{const i=r.user;A(i).then(async()=>{await I(C(m,"users",this.usersList[s].name)),this.usersList.splice(s,1);for(let a=0;a<this.usersList.length;a++)this.usersList[a].id!==a&&(this.usersList[a].id=a)}).catch(a=>{console.log(a)})}).catch(r=>{console.log(r)}),setTimeout(()=>{this.loading=!1},1e3)},async saveUser(s){this.loading=!0,this.uploaded=!1;const t=_(y);w(t,this.usersList[s].email,this.usersList[s].password).then(async r=>{const i=r.user;i.email!==this.usersList[s].emailChange&&(this.usersList[s].email=this.usersList[s].emailChange,T(i,this.usersList[s].emailChange).catch(u=>{console.log(u)})),this.usersList[s].passwordChange!==""&&this.usersList[s].passwordChange===this.usersList[s].passwordCheck&&this.usersList[s].password!==this.usersList[s].passwordChange&&(this.usersList[s].password=this.usersList[s].passwordChange,V(i,this.usersList[s].password).catch(u=>{console.log(u)}));const a={email:this.usersList[s].email,password:this.usersList[s].password,user:this.usersList[s].user,fullName:this.usersList[s].fullName,phone:this.usersList[s].phone,creditCard:this.usersList[s].creditCard,address:this.usersList[s].address,gender:this.usersList[s].gender,language:this.usersList[s].language};await F(C(m,"users",this.usersList[s].name),a).then(()=>{this.uploaded=!0}),this.usersList[s].passwordChange="",this.usersList[s].passwordCheck=""}).catch(r=>{console.log(r)}),setTimeout(()=>{this.loading=!1},1e3)}}});const O=e("h2",null,"Пользователи",-1),Q={class:"search-container"},R={class:"table-responsive mt-3"},X={class:"table table-striped table-bordered table-hover"},Y=e("tr",null,[e("td",null,"Дата рождения"),e("td",null,"Email"),e("td",null,"Пол"),e("td",null,"Телефон")],-1),Z=e("td",null,[e("button",{class:"btn btn-block btn-success"},"Редактировать")],-1),ss=["onClick"],es={class:"pagination"},ts=["disabled"],as=["disabled"],ns={class:"modal-dialog",role:"document"},ls={class:"modal-content"},is={class:"modal-header"},rs=e("h5",{class:"modal-title"},"Удалить пользователя?",-1),os=e("span",{"aria-hidden":"true"},"×",-1),us=[os],ds=e("div",{class:"modal-body"}," Удалить пользователя? ",-1),hs={class:"modal-footer"},gs={__name:"Users",setup(s){const t=h(!1),r=h(0),i=K(),a=h(1),u=h(5),d=h("");G(()=>{i.getUsers()});function x(o){if(o==="man")return"Мужской";if(o==="woman")return"Женский"}const f=b(()=>d.value?i.usersList.filter(o=>o.email.includes(d.value)):i.usersList),P=b(()=>{const o=(a.value-1)*u.value,n=o+u.value;return f.value.slice(o,n)}),L=b(()=>Math.ceil(f.value.length/u.value));function D(){a.value>1&&a.value--}function E(){a.value<L.value&&a.value++}function M(o){i.deleteUser(o)}return(o,n)=>{const N=j("Loader");return c(),p(U,null,[v(i).loading?(c(),z(N,{key:0})):k("",!0),O,e("div",Q,[H(e("input",{style:{width:"30%"},"onUpdate:modelValue":n[0]||(n[0]=l=>d.value=l),type:"text",placeholder:"Введите email для поиска пользователя"},null,512),[[J,d.value]]),d.value.length>0?(c(),p("span",{key:0,style:{cursor:"pointer",color:"red"},onClick:n[1]||(n[1]=l=>d.value="")},"Очистить поле")):k("",!0)]),e("div",R,[e("table",X,[e("tbody",null,[Y,(c(!0),p(U,null,W(v(P),l=>(c(),p("tr",{key:l.id},[e("td",null,g(l.birthday),1),e("td",null,g(l.email),1),e("td",null,g(x(l.gender)),1),e("td",null,g(l.phone),1),Z,e("td",null,[e("button",{class:"btn btn-block btn-danger",onClick:cs=>{t.value=!0,r.value=l.id}},"Удалить",8,ss)])]))),128))])])]),e("div",es,[e("button",{onClick:D,disabled:a.value===1,class:"btn btn-primary"},"Назад",8,ts),e("button",{onClick:E,disabled:a.value===v(L),class:"btn btn-primary"},"Вперёд",8,as)]),e("div",{class:q(["modal fade show",{"d-block":t.value}]),tabindex:"-1","aria-labelledby":"exampleModalLabel","aria-hidden":"true"},[e("div",ns,[e("div",ls,[e("div",is,[rs,e("button",{type:"button",class:"close",onClick:n[2]||(n[2]=l=>t.value=!1)},us)]),ds,e("div",hs,[e("button",{type:"button",class:"btn btn-secondary",onClick:n[3]||(n[3]=l=>t.value=!1)},"Отмена"),e("button",{type:"button",class:"btn btn-danger",onClick:n[4]||(n[4]=l=>{M(r.value),t.value=!1})},"Да")])])])],2)],64)}}};export{gs as default};
